<!DOCTYPE html>
<html lang="en" data-theme="forest">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reactive Currency Converter</title>
    <!-- DaisyUI -->
    <link href="assets/daisyui.css" rel="stylesheet" type="text/css" />
    <!-- Tailwind CSS -->
    <script src="assets/tailwindcss.js"></script>
    <!-- Theme Change -->
    <script src="assets/theme-change.js"></script>
    <!-- Alpine.js -->
    <script src="assets/alpine.js" defer></script>
</head>

<body class="bg-base-200 min-h-screen flex items-center justify-center font-sans" x-data="currencyConverter()">

    <div class="card w-96 bg-base-100 shadow-xl">
        <div class="card-body">
            <div class="flex justify-between items-center mb-4">
                <h2 class="card-title text-primary text-2xl">Converter</h2>
                <!-- Theme Controller -->
                <select data-choose-theme class="select select-bordered select-xs w-24 px-4">
                    <option value="forest">Forest</option>
                    <option value="cupcake">Cupcake</option>
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                    <option value="cyberpunk">Cyberpunk</option>
                </select>
            </div>

            <!-- Input Section: Row with 2/3 Amount and 1/3 Currency -->
            <div class="flex gap-2">
                <!-- Amount Input (2/3 width) -->
                <div class="form-control w-2/3">
                    <label class="label pt-0 pb-1">
                        <span class="label-text text-xs">Amount</span>
                    </label>
                    <div class="relative">
                        <span class="absolute left-3 top-2.5 font-bold text-base-content/50 z-10"
                            x-text="getSymbol(fromCurrency)"></span>
                        <input type="number" step="any" x-model="amount"
                            class="input input-bordered w-full pl-8 font-bold" placeholder="1.00">
                    </div>
                </div>

                <!-- Currency Select (1/3 width) -->
                <div class="form-control w-1/3">
                    <label class="label pt-0 pb-1">
                        <span class="label-text text-xs">Currency</span>
                    </label>
                    <select x-model="fromCurrency" class="select select-bordered w-full px-4">
                        <template x-for="(rate, code) in rates" :key="code">
                            <option :value="code" x-text="code"></option>
                        </template>
                    </select>
                </div>
            </div>

            <!-- Conversion Table -->
            <div class="overflow-x-auto mt-4">
                <table class="table table-zebra w-full">
                    <!-- Removed Header -->
                    <tbody>
                        <template x-for="(rate, code) in rates" :key="code">
                            <tr x-show="code !== fromCurrency" class="hover border-base-200">
                                <td class="font-bold py-3 text-base-content/80">
                                    <span x-text="code"></span>
                                    <span class="text-xs font-normal opacity-70 ml-1" x-text="getSymbol(code)"></span>
                                </td>
                                <td class="text-right py-3 text-lg font-sans font-medium text-accent">
                                    <span x-text="convert(rate)"></span>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <p class="text-xs text-base-content/50 mt-4 text-center">Live rates updated instantly.</p>
        </div>
    </div>

    <script>
        function currencyConverter() {
            return {
                amount: 1,
                rates: {},
                symbols: {},
                fromCurrency: '',

                init() {
                    fetch('rates.json')
                        .then(response => response.json())
                        .then(data => {
                            if (data.rates) {
                                this.rates = data.rates;
                                this.symbols = data.symbols || {};

                                if (data.info && data.info.default_from && this.rates[data.info.default_from]) {
                                    this.fromCurrency = data.info.default_from;
                                } else {
                                    this.fromCurrency = Object.keys(this.rates)[0] || 'USD';
                                }
                            } else {
                                // Fallback for simple structure if needed, though rates.json structure is known
                                this.rates = data;
                                this.fromCurrency = Object.keys(this.rates)[0] || 'USD';
                            }
                        })
                        .catch(error => console.error('Error fetching rates:', error));
                },

                convert(targetRate) {
                    if (!this.amount || !this.fromCurrency || !this.rates[this.fromCurrency]) {
                        return '0.0000';
                    }

                    const fromRate = this.rates[this.fromCurrency];
                    const baseAmount = this.amount / fromRate;
                    const convertedAmount = baseAmount * targetRate;

                    return convertedAmount.toLocaleString(undefined, {
                        minimumFractionDigits: 4,
                        maximumFractionDigits: 4
                    });
                },

                getSymbol(code) {
                    return (this.symbols && this.symbols[code]) ? this.symbols[code] : '';
                }
            }
        }
    </script>
</body>

</html>